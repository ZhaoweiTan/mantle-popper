---
- hosts: clients[0]
  tasks:
  - name: make a fake dir
    shell: docker exec cephfs mkdir /cephfs/test
    ignore_errors: true

  - name: touch n files
    shell: docker exec cephfs touch /cephfs/test/file-{{ item }}
    with_sequence: start=0 end=100

  - name: force a readding
    shell: docker exec cephfs ls -alh /cephfs/test

- hosts: mdss
  tasks:
  - shell: docker exec ceph-{{ ansible_hostname }}-mds lttng stop
    ignore_errors: true

  - name: tar up the traces
    shell: docker exec ceph-{{ ansible_hostname }}-mds tar czvf /var/lib/ceph/lttng.tar.gz lttng
    args:
      chdir: /var/lib/ceph

  - name: fetch those traces
    fetch:
      dest: ../results/{{ site }}/lttng-{{ ansible_hostname }}.tar.gz
      src: /var/lib/ceph/lttng.tar.gz
      flat: yes

  #- name: spit results to a file
  #  local_action: >
  #    copy 
  #    content={{ results.stdout }} 
  #    dest=../results/{{ site }}/mdtest-{{ inventory_file | basename }}-{{ results.start | replace(' ', '_') }}.txt
  #  with_items: "{{ results }}"
